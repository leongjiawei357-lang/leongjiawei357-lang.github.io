<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard | Inventory System</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    /* Dashboard quick-access buttons */
    .dashboard-buttons {
      display: flex;
      gap: 20px;
      margin: 20px 0;
    }
    .dashboard-button {
      flex: 1;
      padding: 30px;
      background: #44bd32;
      color: white;
      font-size: 24px;
      text-align: center;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .dashboard-button:hover {
      background: #4cd137;
    }
    .info-card {
      margin-top: 20px;
      background: #f1f2f6;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .info-card table {
      width: 100%;
      border-collapse: collapse;
    }
    .info-card th, .info-card td {
      padding: 8px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    .clock {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <header>
    <h1>ğŸ  Home Dashboard</h1>
    <nav>
      <a href="index.html">Home</a>
      <a href="inventory.html">Inventory</a>
      <a href="documents.html">Documents</a>
      <a href="log.html">Activity Log</a>
      <button onclick="toggleTheme()">ğŸŒ“ Mode</button>
      <button onclick="logout()">ğŸšª Logout</button>
      <div id="adminInfo">Logged in as: <span id="adminName"></span></div>
    </nav>
  </header>

  <section>
    <h2>Welcome to the Inventory & Document Management System</h2>
    <p>This dashboard provides quick access to your inventory, document uploads, and activity log.</p>
    <ul>
      <li>ğŸ“¦ Manage inventory with SKU tracking.</li>
      <li>ğŸ“„ Upload and manage important documents.</li>
      <li>ğŸ•’ Review all actions in your activity log.</li>
      <li>ğŸ› ï¸ The website was developed by Brendan Jong & Leong Jia Wei</li>
      <li>âš™ï¸ Render Cloud database was established and managed by Leong</li>
    </ul>

    <!-- Real-time clock -->
    <div class="clock" id="clock"></div>

    <!-- Quick access buttons -->
    <div class="dashboard-buttons">
      <div class="dashboard-button" onclick="window.location.href='inventory.html'">ğŸ“¦ Inventory</div>
      <div class="dashboard-button" onclick="window.location.href='documents.html'">ğŸ“„ Documents</div>
    </div>

    <!-- Total users logged in today -->
    <div class="info-card">
      <h3>ğŸ§‘â€ğŸ§‘ Users Logged In Today</h3>
      <p id="totalUsers">0</p>
    </div>

    <!-- Recent activity log -->
    <div class="info-card">
      <h3>ğŸ•’ Recent Activity Log</h3>
      <table>
        <thead>
          <tr>
            <th>User</th>
            <th>Action</th>
            <th>Time</th>
          </tr>
        </thead>
        <tbody id="recentActivities">
          <!-- populated dynamically -->
        </tbody>
      </table>
    </div>
  </section>

  <script src="script.js"></script>
  <script>
    // ===============================
    // REAL-TIME CLOCK
    // ===============================
    function updateClock() {
      const now = new Date();
      const options = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };
      const dateStr = now.toLocaleDateString(undefined, options);
      const timeStr = now.toLocaleTimeString();
      document.getElementById('clock').textContent = `ğŸ“… ${dateStr} â° ${timeStr}`;
    }
    setInterval(updateClock, 1000);
    updateClock();

    // ===============================
    // FETCH RECENT ACTIVITIES & USERS
    // ===============================
    async function fetchDashboardData() {
      try {
        const res = await fetch(API_BASE + '/logs'); // Fetch logs from server
        if (!res.ok) return;
        const logs = await res.json();

        // Show recent 5 activities
        const tbody = document.getElementById('recentActivities');
        tbody.innerHTML = '';
        logs.slice(0,5).forEach(log => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${log.user || 'Admin'}</td><td>${log.action}</td><td>${log.time}</td>`;
          tbody.appendChild(tr);
        });

        // Count unique users logged in today
        const today = new Date().toLocaleDateString();
        const usersToday = new Set(logs.filter(l => new Date(l.time).toLocaleDateString() === today).map(l => l.user));
        document.getElementById('totalUsers').textContent = usersToday.size;

      } catch(e) {
        console.error("Error fetching dashboard data:", e);
      }
    }

    setInterval(fetchDashboardData, 5000);
    fetchDashboardData();
  </script>
</body>
</html>
